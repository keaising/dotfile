# normal --- {{{
set -g @scroll-speed-num-lines-per-scroll 3
set -g mouse                              on
set -g status-justify                     centre

# scroll back buffer n lines
set  -g history-limit     100000
set  -g display-time      4000
# for os x
set  -g set-clipboard     on

setw -g mode-keys         vi

set  -g base-index        1
setw -g pane-base-index   1

# focus events enabled for terminals that support them
set  -g focus-events      on
# super useful when using "grouped sessions" and multi-monitor setup
setw -g aggressive-resize on

# --- }}}


# style ---{{{
# set -g  window-style        'fg=colour247,bg=colour236'
# set -g  window-active-style 'fg=colour251,bg=black'

# terminal settings
# https://github.com/microsoft/WSL/issues/5931#issuecomment-1296783606
set -sg escape-time         1
# cursor blink in vim
set -ga terminal-overrides ',*:Ss=\E[%p1%d q:Se=\E[2 q'

# for osc52, "screen-256color" must match with $TERM from shell
# Never upgrade to version 3.3a! osc52 will be broken.
set -ga terminal-overrides ",*256col*:Tc"
# under curl
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'
# underscore colours - needs tmux-3.0
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'
set -g  default-terminal   "screen-256color"
set -as terminal-features ',screen-256color:clipboard'

# refresh every second
set -g status-interval 1

# --- }}}


# key binding --- {{{
set    -g  prefix C-a
bind   C-a send-prefix
unbind C-b
unbind ,
unbind Right

# reload config
bind R source-file ~/.tmux.conf

# kill
bind x kill-pane
bind X kill-window
bind K confirm kill-session
# bind K confirm kill-server
# you should not use shortcut to kill server

# window switch 
#| n => next window
#| p => previous window
#| { => move current pane to previous position
#| } => move current pane to next position
bind -r n  next-window
bind -r p  previous-window
bind Left  previous-window
bind Right next-window
bind o move-window -r

bind \{ swap-window -t -1\; select-window -t -1
bind \} swap-window -t +1\; select-window -t +1
bind ,  swap-window -t -1\; select-window -t -1
bind .  swap-window -t +1\; select-window -t +1

# session
bind Down  switch-client  -n
bind Up    switch-client  -p
bind Enter switch-client  -l
bind C-r   command-prompt "rename-session %%"

# layout
bind ]  next-layout
bind [  previous-layout
bind !  select-layout main-vertical   # shift + 1
bind @  select-layout main-horizontal # shift + 2
bind \# select-layout even-vertical   # shift + 3
bind $  select-layout even-horizontal # shift + 4
bind %  select-layout tiled           # shift + 5

# window rename 
bind-key v new-window \; rename-window "#{b:pane_current_path}"
bind-key c run-shell      "tmux neww ~/.local/bin/tmux-new-window"
bind-key r command-prompt "rename-window %%"

bind-key Space rename-window "#{b:pane_current_path}"


# window-pane switch
bind b break-pane     -s :
bind t command-prompt -p "join pane from:" "join-pane -h -s '%%'"
bind y command-prompt -p "join pane from:" "join-pane -v -s '%%'"
# bind-key s command-prompt -p "send pane to:"   "join-pane -h -t '%%'"

### C-o: rotate all panes

# pane split
bind   |  split-window -h -c "#{pane_current_path}"
bind   \\ split-window -h -c "#{pane_current_path}"
bind   -  split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# pane resizing  
bind -r C-k resize-pane -U 5
bind -r C-j resize-pane -D 5
bind -r C-h resize-pane -L 5
bind -r C-l resize-pane -R 5

# pane switching
bind k select-pane -U
bind j select-pane -D
bind h select-pane -L
bind l select-pane -R

# pane swap
bind H swap-pane -U
bind L swap-pane -D

bind f run-shell "tmux neww ~/.local/bin/tmux-sessionizer"
# set-hook -g pane-focus-in 'rename-window "#{b:pane_current_path}"'

bind -n S-M-Left {
  copy-mode
  send -X clear-selection
  send -X start-of-line
  send -X cursor-left
  send -X begin-selection
  send -X start-of-line
  send -X stop-selection
}

bind -n S-M-Up {
  copy-mode
  send -X clear-selection
  send -X cursor-up
  send -X start-of-line
  send -X start-of-line
  send -X cursor-left
  send -X begin-selection
  send -X search-backward "(Δ )|(Ε )|(✘ )"
  send -X start-of-line
  send -X start-of-line
  send -X stop-selection
}

bind -n S-M-Right {
  copy-mode
  send -X clear-selection
  send -X cursor-down
  send -X start-of-line
  send -X begin-selection
  send -X end-of-line
  send -X stop-selection
}

bind -n S-M-Down {
  copy-mode
  send -X clear-selection
  send -X end-of-line
  send -X end-of-line
  send -X search-forward "(Δ )|(Ε )|(✘ )"
  send -X start-of-line
  send -X start-of-line
  send -X begin-selection
  send -X search-forward  "(Δ )|(Ε )|(✘ )"
  send -X cursor-up
  send -X start-of-line
  send -X start-of-line
  send -X cursor-left
  send -X stop-selection
}

# --- }}}


# plugins --- {{{
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'

# power line
# set -g @plugin                      'wfxr/tmux-power'
# set -g @tmux_power_theme            '#b4a992' #'sky'
# set -g @tmux_power_left_arrow_icon  ' '
# set -g @tmux_power_right_arrow_icon ' '
# if-shell '[ ! -z "$(env | grep SSH_CONNECTION 2>/dev/null)" ]' {
#   set -g @tmux_power_theme          'gold'
# }

# theme --- {{{

#!/usr/bin/env bash
# Nightfox colors for Tmux
# Style: dayfox
# Upstream: https://github.com/edeneast/nightfox.nvim/raw/main/extra/dayfox/dayfox.tmux
set -g mode-style "fg=#e4dcd4,bg=#643f61"
set -g message-style "fg=#e4dcd4,bg=#643f61"
set -g message-command-style "fg=#e4dcd4,bg=#643f61"
set -g pane-border-style "fg=#643f61"
set -g pane-active-border-style "fg=#2848a9"
set -g status "on"
set -g status-justify "centre"
set -g status-style "fg=#643f61,bg=#e4dcd4"
set -g status-left-length "100"
set -g status-right-length "100"
set -g status-left-style NONE
set -g status-right-style NONE
set -g status-left "#[fg=#e4dcd4,bg=#2848a9,bold] #S #[fg=#2848a9,bg=#e4dcd4,nobold,nounderscore,noitalics]"
set -g status-right "#[fg=#e4dcd4,bg=#e4dcd4,nobold,nounderscore,noitalics]#[fg=#2848a9,bg=#e4dcd4] #{prefix_highlight} #[fg=#643f61,bg=#e4dcd4,nobold,nounderscore,noitalics]#[fg=#e4dcd4,bg=#643f61] %Y-%m-%d %H:%M:%S #[fg=#2848a9,bg=#643f61,nobold,nounderscore,noitalics]#[fg=#e4dcd4,bg=#2848a9,bold] #h "
setw -g window-status-activity-style "underscore,fg=#824d5b,bg=#e4dcd4"
setw -g window-status-separator ""
setw -g window-status-style "NONE,fg=#824d5b,bg=#e4dcd4"
setw -g window-status-format "#[fg=#e4dcd4,bg=#e4dcd4,nobold,nounderscore,noitalics]#[default] #I  #W #F #[fg=#e4dcd4,bg=#e4dcd4,nobold,nounderscore,noitalics]"
setw -g window-status-current-format "#[fg=#e4dcd4,bg=#643f61,nobold,nounderscore,noitalics]#[fg=#e4dcd4,bg=#643f61,bold] #I  #W #F #[fg=#643f61,bg=#e4dcd4,nobold,nounderscore,noitalics]"

# --- }}}

# set-environment -g PATH "/usr/local/bin:/bin:/usr/bin"

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
# 1. git clone https://github.com/tmux-plugins/tpm.git $HOME/code/github.com/tmux-plugins/tpm
# 2. $HOME/code/github.com/tmux-plugins/tpm/bin/install_plugins
run '~/code/github.com/tmux-plugins/tpm/tpm'

# --- }}}
